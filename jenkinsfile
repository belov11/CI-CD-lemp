pipeline {
  agent any

  stages {
    stage('Clone GitHub repo') {
      steps {
        git branch: 'main', 
            credentialsId: 'github-ssh-key', 
            url: 'git@github.com:belov11/CI-CD-lemp.git'
      }
    }

    stage('Transfer to Server') {
      steps {
        script {
          // Установка параметров соединения для SSH
          def remoteHost = '192.168.56.22'
          def remoteUser = 'vagrant'
          def remoteDir = '/home/vagrant/web-ser/'

          // Создание SSH-клиента
          sshagent(['web-server-private-key']) {
            // sh "ssh ${remoteUser}@${remoteHost} mkdir -p ${remoteDir}"
            sh "scp -r repository ${remoteUser}@${remoteHost}:${remoteDir}"
          }
        }
      }
    }
  }
}
